(function(e){function t(t){for(var n,s,i=t[0],l=t[1],c=t[2],u=0,h=[];u<i.length;u++)s=i[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&h.push(r[s][0]),r[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);d&&d(t);while(h.length)h.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,i=1;i<a.length;i++){var l=a[i];0!==r[l]&&(n=!1)}n&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},r={app:0},o=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var d=l;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("85ec"),r=a.n(n);r.a},"058b":function(e,t,a){"use strict";var n=a("0bfa"),r=a.n(n);r.a},"0bfa":function(e,t,a){},"31ca":function(e,t,a){},"3a7d":function(e,t,a){},"41f0":function(e,t,a){},"447e":function(e,t,a){"use strict";var n=a("31ca"),r=a.n(n);r.a},5624:function(e,t,a){"use strict";var n=a("8084"),r=a.n(n);r.a},"56d7":function(e,t,a){"use strict";a.r(t);a("4160"),a("159b"),a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},o=[],s={name:"App"},i=s,l=(a("034f"),a("2877")),c=Object(l["a"])(i,r,o,!1,null,null,null),d=c.exports,u=a("bc3a"),h=a.n(u),p=a("8c4f"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text item"},[e._v("1.数据来源：Cantor API")]),a("div",{staticClass:"text item"},[e._v("2.高亮黄色为含有弱依赖的任务，如果在白名单中则不高亮展示，可以增/删报警白名单")]),a("div",{staticClass:"text item"},[e._v("3.可以在依赖树中点击卡片跳转到xt平台进行配置")]),a("div",{staticClass:"text item"},[e._v("4.依赖树为快照数据，可刷新为最新数据")]),a("div",{staticClass:"text item"},[e._v("5.任务备注可以点击编辑")])]),a("el-row",{attrs:{gutter:2}},[a("el-col",{attrs:{span:2,offset:16}},[a("el-dropdown",[a("el-button",[e._v(" 过滤项目组 "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[e._v("hmart_waimaiuser")]),a("el-dropdown-item",[e._v("hmart_waimai_bizdata")]),a("el-dropdown-item",[e._v("hmart_waimaibizdata")]),a("el-dropdown-item",[e._v("hadoop-waimaibizdata")]),a("el-dropdown-item",[e._v("hadoop-hmart-waimaiuser")]),a("el-dropdown-item",[e._v("mart_waimaibizdatacollect_bizdatacollect")])],1)],1)],1),a("el-col",{attrs:{span:2}},[a("el-dropdown",{on:{command:e.handleCommand}},[a("el-button",[e._v(" 报警白名单 "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.whiteDropList,(function(t,n){return a("el-dropdown-item",{key:n,attrs:{command:t.name}},[e._v(" "+e._s(t.name)+" "),a("i",{staticClass:"el-icon-delete"})])})),1)],1)],1),a("el-col",{attrs:{span:2}},[a("el-button",{on:{click:e.addTask}},[e._v("增加ETL任务")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","row-class-name":e.tableRowClassName},on:{"cell-click":e.showEditRemark}},[a("el-table-column",{attrs:{prop:"taskname",label:"任务名"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{directives:[{name:"show",rawName:"v-show",value:t.row.showEdit,expression:"scope.row.showEdit"}],ref:"remark"+t.$index,attrs:{placeholder:"请输入备注"},on:{blur:function(a){return e.handleUpdate(t.$index,t.row)}},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleUpdate(t.$index,t.row)}},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.row.showEdit,expression:"!scope.row.showEdit"}]},[e._v(e._s(t.row.remark))])]}}])}),a("el-table-column",{attrs:{prop:"utime",label:"依赖树快照时间",width:"200"}}),a("el-table-column",{attrs:{width:"340",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.showTree(t.$index,t)}}},[e._v("展示依赖树")]),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.refreshTree(t.$index,t)}}},[e._v("刷新依赖树")]),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.addWhiteList(t.$index,t)}}},[e._v("添加白名单")])]}}])})],1),a("el-drawer",{attrs:{title:"依赖树",visible:e.drawer,size:"80%","with-header":!1},on:{"update:visible":function(t){e.drawer=t}}},[a("div",[a("VueSvgTree",{ref:"svgTree",attrs:{treeData:e.treeData,direction:"row",svgId:"svg"}})],1)])],1)},f=[],g=(a("c975"),a("96cf"),a("1da1")),v=function(e){return h.a.request({url:"etl/get-task-parents",method:"GET",params:e})},w=function(e){return h.a.request({url:"etl/query-relation-graph",method:"POST",data:e})},k=function(){return h.a.request({url:"etl/query-leaf-etl",method:"GET"})},b=function(e){return h.a.request({url:"etl/get-task-parents-without-filter",method:"GET",params:e})},x=function(){return h.a.request({url:"etl/get-etl-tasks",method:"GET"})},y=function(){return h.a.request({url:"etl/query-task-ready-time",method:"GET"})},T=function(e){return h.a.post("etl/add-task",null,{params:{taskName:e}})},$=function(e){return h.a.post("etl/add-task-depend",null,{params:{taskName:e}})},_=function(e){return h.a.post("etl/update-ready-time",null,{params:{taskName:e}})},D=function(e){return h.a.post("etl/add-white-list",null,{params:{taskName:e}})},E=function(e){return h.a.post("etl/remove-white-list",null,{params:{taskName:e}})},L=function(){return h.a.request({url:"etl/get-white-list",method:"GET"})},N=function(e,t){return h.a.post("etl/update-task-remark",null,{params:{taskName:e,remark:t}})},O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("div",{ref:"treeContent",staticClass:"draw-area",attrs:{id:"treeContent"}},[e._l(e.levels,(function(t,n){return a("div",{key:n},e._l(t,(function(t,n){return!t.parent||t.parent.open?a("div",{key:n,staticClass:"vnode",class:{pnode:t.children&&t.children.length>0},style:"left:"+t.left+"px; top:"+t.top+"px",on:{click:function(a){return e.toggle(t)}}},[a("div",{staticClass:"text"},[a("div",{staticClass:"node_des"},[a("div",[e._v(e._s(t.taskName))]),a("div",[e._v("任务状态："+e._s(t.status))]),a("div",[e._v("执行时间："+e._s(t.time)+"s")])])])]):e._e()})),0)})),e.curveness?a("svg",{attrs:{id:e.svgId}},e._l(e.list,(function(t,n){return t.deep>0&&t.parent.open?a("line",{staticClass:"link",attrs:{x1:t.left+90,y1:t.top,x2:t.parent.left+105,y2:t.parent.top+150,stroke:t.color?t.color:"#aaa","stroke-width":t.strokeWidth?t.strokeWidth:"1px"}}):e._e()})),0):e._e(),e.curveness?e._e():a("svg",{attrs:{id:e.svgId}},e._l(e.list,(function(t,n){return t.deep>0&&t.parent.open?a("path",{staticClass:"link",attrs:{d:t.path,stroke:t.color?t.color:"black","stroke-width":t.strokeWidth?t.strokeWidth:"1px"}}):e._e()})),0)],2)])},S=[],R=(a("4de4"),a("0481"),a("4069"),50),C=300,M={name:"VueSvgTree",data:function(){return{rules:{min:200,max:350},delayRules:{min:10,max:300},root:null,list:null,levels:null}},props:{treeData:{type:Array},direction:{type:String,default:"row"},svgId:{type:String,default:"svg"},curveness:{type:Boolean,default:!1}},mounted:function(){this.treeData&&this.treeData.length>0&&this.initData(JSON.parse(JSON.stringify(this.treeData)))},watch:{treeData:function(e){e&&e.length>0&&this.initData(JSON.parse(JSON.stringify(e)))}},methods:{compare:function(e,t){return e.deep!==t.deep?e.deep-t.deep:e.parent===t.parent?e.id-t.id:this.compare(e.parent,t.parent)},initData:function(e){var t=this;console.log("data",e);var a={},n=null,r=[];(e||e.length>0)&&(e.forEach((function(e){a[e.id]=e,e.deep=0,e.top=0,e.height=0,e.width=0,e.path="",e.left=0,e.prev=null})),e.forEach((function(e){if(e.fatherId||e.fatherId>0){var r=a[e.fatherId];r.children=r.children||[],r.children.push(e),e.parent=r,e.deep=r.deep+1,e.left="col"==t.direction?300*e.deep+10:0,e.top="row"==t.direction?250*e.deep+5:0,e.open=!0,e.show=!0}else n=e,e.open=!0,e.show=!0})),e.sort(this.compare),e.forEach((function(e){r[e.deep]=r[e.deep]||[],r[e.deep].push(e),e.prev=r[e.deep][r[e.deep].length-2]})),this.root=n,this.list=e,console.log("daya",e),this.levels=r,"col"==this.direction?(this.calcHeight(n),this.calcTop(),this.calSvg()):(this.calWidth(n),this.calcLeft(),this.calSvgVer()))},calcHeight:function(e){var t=this,a=0;e.parent&&!e.parent.open?(e.height=0,e.open=!1):e.open||(e.height=R),e.children&&e.children.length>0&&e.children.forEach((function(e){t.calcHeight(e),a+=e.height})),e.open&&(e.height=a||R)},calWidth:function(e){var t=this,a=0;e.parent&&!e.parent.open?(e.height=0,e.width=0,e.open=!1):e.open||(e.width=C),e.children&&e.children.length>0&&e.children.forEach((function(e){t.calWidth(e),a+=e.width})),e.open&&(e.width=a||C)},calSvg:function(){var e=this;this.$nextTick((function(){e.levels.flat(1/0).filter((function(e){return e.show})).sort((function(e,t){return t.top-e.top}))[0].top;var t=document.getElementById(e.svgId);console.log("svg",t),t.setAttribute("height",500),t.setAttribute("width",700),e.$emit("toggle",e.$refs.treeContent.scrollWidth,e.root.height)}))},calSvgVer:function(){var e=this;this.$nextTick((function(){e.levels.flat(1/0).filter((function(e){return e.show})).sort((function(e,t){return t.top-e.top}))[0].top;var t=document.getElementById(e.svgId);t.setAttribute("height",e.$refs.treeContent.scrollHeight),t.setAttribute("width",e.root.width),e.$emit("toggle",{width:e.root.width,height:e.$refs.treeContent.scrollHeight})}))},calcTop:function(e,t){if(e||(e=this.root),t=t||0,e.top=t+e.height/2,e.children&&e.children.length>0)for(var a=0;a<e.children.length;a++){var n=e.children[a].height;this.calcTop(e.children[a],t),t+=n}if(e.parent){var r=e.parent.left+C-40,o=e.parent.top,s=(e.left+r)/2;e.top;e.path="M"+e.left+","+e.top+" C "+s+" "+e.top+","+s+" "+o+","+r+" "+o+"L "+(e.parent.left+10)+","+o}},calcLeft:function(e,t){if(e||(e=this.root),t=t||0,e.left=t+e.width/2,e.children&&e.children.length>0)for(var a=0;a<e.children.length;a++){var n=e.children[a].width;this.calcLeft(e.children[a],t),t+=n}if(e.parent){var r=e.parent.left+115,o=e.parent.top+150,s=e.left+115,i=e.top,l=(r+s)/2,c=s>r?s+5:s-5;e.path=s==r?"M"+s+","+i+"  L "+r+","+o:"M"+s+","+i+" Q "+c+","+(i-30)+" "+l+","+(i-30)+" T "+r+","+o}console.log("vnode",e)},toggle:function(e){window.open("http://xt.sankuai.com/workbench/task/"+e.taskName)},showDetail:function(e){delete e.children,this.$emit("detail",e)},addTarget:function(e){delete e.children,console.log("1111111",e),this.$emit("add",e)},editTarget:function(e){delete e.children,console.log("2222222",e),this.$emit("edit",e)},detailTarget:function(e){delete e.children,this.$emit("detail",e)},refreshTarget:function(e){delete e.children,console.log("3333333",e),this.$emit("refresh",e)}}},A=M,I=(a("769f"),Object(l["a"])(A,O,S,!1,null,null,null)),j=I.exports,z={components:{VueSvgTree:j},data:function(){return{activeIndex:"1",statusMap:{0:"未开始",1:"运行中",2:"执行出错",3:"执行成功",4:"暂停调度",13:"就绪，等待执行"},input:"",treeData:[],tableData:[],whiteDropList:[],whiteList:[],drawer:!1}},mounted:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.getWhiteList(),t.next=3,e.initTask();case 3:null!=e.$route.query.taskName&&e.tableData.forEach((function(t){t.taskname==e.$route.query.taskName&&(console.log("route data",t),e.treeData=t.treeData,e.drawer=!0)}));case 4:case"end":return t.stop()}}),t)})))()},methods:{initData:function(){var e=this,t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),a={taskName:"mart_waimaibizdatacollect_bizdatacollect.wm_bizdata_poly_map_dis_aor_v4"};console.log(a),v(a).then((function(a){console.log(a),0===a.data.code?function(){var t=e,n=a.data.data,r=[],o=1;n["id"]=o++,r.push(n),e.treeData=[],e.treeData.push({id:n["id"],taskName:n["taskName"],fatherId:0,time:n["execTime"],status:t.statusMap[n["status"]]}),console.log(e.treeData);var s=function(){var a=r.shift();console.log(a["taskName"],a);var n=a["parents"];null!=n&&n.forEach((function(n){n["id"]=o++,r.push(n),e.treeData.push({id:n["id"],taskName:n["taskName"],dependType:n["dependType"],color:1==n["dependType"]?"black":"red",fatherId:a["id"],time:n["execTime"],status:t.statusMap[n["status"]]}),console.log(e.treeData)}))};while(0!=r.length)s()}():e.$message.error("网络错误"),t.close()})).catch((function(a){t.close(),e.$message.error("网络错误"),console.error(a)}))},initTask:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t.next=3,x().then((function(t){if(console.log(t),0===t.data.code){var n=e,r=t.data.data;null!=r&&void 0!=r&&(e.tableData=[],r.forEach((function(t){var a={};a["taskname"]=t["taskName"],a["remark"]=t["remark"],a["utime"]=t["utime"],a["hasWeakRelation"]=t["weakRelation"].length>0&&-1==e.whiteList.indexOf(t["taskName"]),console.log("weakRelation",e.whiteList,t["taskName"]);var r=[],o=1;t["id"]=o++,r.push(t);var s=[];s.push({id:t["id"],taskName:t["taskName"],fatherId:0,time:t["execTime"],status:n.statusMap[t["status"]]});var i=function(){var e=r.shift();console.log(e["taskName"],e);var t=e["parents"];null!=t&&t.forEach((function(t){t["id"]=o++,r.push(t),s.push({id:t["id"],taskName:t["taskName"],dependType:t["dependType"],color:1==t["dependType"]?"black":"red",fatherId:e["id"],time:t["execTime"],status:n.statusMap[t["status"]]})}))};while(0!=r.length)i();o=1,r.push(t);var l=[];l.push({id:t["id"],taskName:t["taskName"],fatherId:0,time:t["execTime"],status:n.statusMap[t["status"]]});var c=function(){var e=r.shift();console.log(e["taskName"],e);var t=e["allParents"];null!=t&&t.forEach((function(t){t["id"]=o++,r.push(t),l.push({id:t["id"],taskName:t["taskName"],dependType:t["dependType"],color:1==t["dependType"]?"black":"red",fatherId:e["id"],time:t["execTime"],status:n.statusMap[t["status"]]})}))};while(0!=r.length)c();a["treeData"]=s,a["allTreeData"]=l,e.tableData.push(a)})))}else e.$message.error("网络错误");a.close()})).catch((function(t){a.close(),e.$message.error("网络错误"),console.error(t)}));case 3:case"end":return t.stop()}}),t)})))()},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return t.index=a,t["hasWeakRelation"]?"warning-row":""},showTree:function(e,t){console.log(t),this.treeData=t.row.treeData,this.drawer=!0},showAllTree:function(e,t){console.log(t),this.treeData=t.row.allTreeData,this.drawer=!0},showEditRemark:function(e,t,a,n){console.log(e,t,a,n),e.showEdit||"remark"!=t.property||(e.showEdit=!0,this.$set(this.tableData,e.index,e),console.log("refs",this.$refs["remark".concat(e.index)]),this.$nextTick((function(){this.$refs["remark".concat(e.index)].$el.querySelector("input").focus()})),this.$set(this.tableData,e.index,e))},handleUpdate:function(e,t){var a=this;console.log(t),t.showEdit=!1,null!=t.taskname&&null!=t.remark&&N(t.taskname,t.remark).then((function(e){console.log(e),0===e.data.code?a.$message.success("更新成功"):a.$message.error("网络错误")})).catch((function(e){a.$message.error("网络错误"),console.error(e)})),this.$set(this.tableData,t.index,t)},refreshTree:function(e,t){var a=this,n=t.row.treeData[0].taskName,r={taskName:n},o=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});console.log(r),v(r).then((function(e){console.log(e),0===e.data.code?function(){var t=a,r=e.data.data,o=[],s=1;r["id"]=s++,o.push(r);var i=[];i.push({id:r["id"],taskName:r["taskName"],fatherId:0,time:r["execTime"],status:t.statusMap[r["status"]]});var l=function(){var e=o.shift();console.log(e["taskName"],e);var a=e["parents"];null!=a&&a.forEach((function(a){a["id"]=s++,o.push(a),i.push({id:a["id"],taskName:a["taskName"],dependType:a["dependType"],color:1==a["dependType"]?"black":"red",fatherId:e["id"],time:a["execTime"],status:t.statusMap[a["status"]]}),console.log(i)}))};while(0!=o.length)l();var c={};c["taskname"]=r["taskName"],c["remark"]=r["remark"],c["utime"]=a.time(),c["hasWeakRelation"]=r["weakRelation"].length>0&&-1==a.whiteList.indexOf(r["taskName"]),c["treeData"]=i;var d=-1;a.tableData.forEach((function(e,t){console.log("task",e),e["taskname"]==n&&(d=t)})),console.log("index",d),console.log("tableTask",c),-1!=d&&a.$set(a.tableData,d,c)}():a.$message.error("网络错误"),o.close()})).catch((function(e){o.close(),a.$message.error("网络错误"),console.error(e)}))},refreshAllTree:function(e,t){var a=this,n=t.row.treeData[0].taskName,r={taskName:n},o=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});b(r).then((function(e){0===e.data.code&&a.initTask(),o.close()})).catch((function(e){o.close(),a.$message.error("网络错误"),console.error(e)}))},addTask:function(){var e=this;this.$prompt("请输入ETL任务名","",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(t){var a=t.value,n=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});null!=a&&T(a).then((function(t){console.log(t),0===t.data.code?(x().then((function(t){if(console.log(t),0===t.data.code){var a=e,r=t.data.data;null!=r&&void 0!=r&&(e.tableData=[],r.forEach((function(t){var n={};n["taskname"]=t["taskName"],n["remark"]=t["remark"],n["utime"]=t["utime"],n["hasWeakRelation"]=t["weakRelation"].length>0&&-1==e.whiteList.indexOf(t["taskName"]);var r=[],o=1;t["id"]=o++,r.push(t);var s=[];s.push({id:t["id"],taskName:t["taskName"],fatherId:0,time:t["execTime"],status:a.statusMap[t["status"]]}),console.log(s);var i=function(){var e=r.shift();console.log(e["taskName"],e);var t=e["parents"];null!=t&&t.forEach((function(t){t["id"]=o++,r.push(t),s.push({id:t["id"],taskName:t["taskName"],dependType:t["dependType"],color:1==t["dependType"]?"black":"red",fatherId:e["id"],time:t["execTime"],status:a.statusMap[t["status"]]})}))};while(0!=r.length)i();n["treeData"]=s,e.tableData.push(n)})))}else e.$message.error("网络错误");n.close()})).catch((function(t){n.close(),e.$message.error("网络错误"),console.error(t)})),e.$message.success("更新成功"),e.$set(e.tableData,0,e.tableData[0])):2===t.data.code?e.$message.error("没有上游依赖"):e.$message.error("网络错误")})).catch((function(t){e.$message.error("网络错误"),console.error(t)}))})).catch((function(){e.$message({type:"info",message:"取消输入"})}))},getWhiteList:function(){var e=this;L().then((function(t){if(console.log(t),0===t.data.code){var a=t.data.data;e.whiteList=[],e.whiteDropList=[];var n=1;a.forEach((function(t){e.whiteDropList.push({name:t,index:n++}),e.whiteList.push(t)}))}else e.$message.error("网络错误")})).catch((function(t){e.$message.error("网络错误"),console.error(t)}))},addWhiteList:function(e,t){var a=this,n=t.row.treeData[0].taskName;D(n).then((function(e){console.log(e),0===e.data.code?(a.$message.success("添加成功"),a.getWhiteList(),t.row.hasWeakRelation=!1,a.$set(a.tableData,t.row.index,t.row)):a.$message.error("网络错误")})).catch((function(e){a.$message.error("网络错误"),console.error(e)}))},handleCommand:function(e){var t=this;E(e).then((function(e){console.log(e),0===e.data.code?(t.$message.success("删除成功"),t.getWhiteList(),t.initTask()):t.$message.error("网络错误")})).catch((function(e){t.$message.error("网络错误"),console.error(e)}))},time:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),r=e.getHours(),o=e.getMinutes(),s=e.getSeconds();return t+"-"+this.addZero(a)+"-"+this.addZero(n)+" "+this.addZero(r)+":"+this.addZero(o)+":"+this.addZero(s)},addZero:function(e){return e<10?"0"+e:e}}},Z=z,H=(a("5624"),Object(l["a"])(Z,m,f,!1,null,"fa4245ee",null)),V=H.exports,W=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text item"},[e._v("1.数据来源：Cantor API")]),a("div",{staticClass:"text item"},[e._v("2.可查看最近30天daily类型的ETL就绪时间")]),a("div",{staticClass:"text item"},[e._v("3.使用箱形图检测异常就绪时间：借助值序列的第一四分位(Q1)和第三四分位(Q3)计算边缘，大于Q3+k(Q3-Q1)的值认为为异常值，k一般取1.5")])]),a("el-row",{attrs:{gutter:2}},[a("el-col",{attrs:{offset:22,span:2}},[a("el-button",{on:{click:e.addTask}},[e._v("增加ETL任务")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","row-class-name":e.tableRowClassName},on:{"cell-click":e.showEditRemark}},[a("el-table-column",{attrs:{prop:"taskname",label:"任务名"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{directives:[{name:"show",rawName:"v-show",value:t.row.showEdit,expression:"scope.row.showEdit"}],ref:"remark"+t.$index,attrs:{placeholder:"请输入备注"},on:{blur:function(a){return e.handleUpdate(t.$index,t.row)}},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleUpdate(t.$index,t.row)}},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.row.showEdit,expression:"!scope.row.showEdit"}]},[e._v(e._s(t.row.remark))])]}}])}),a("el-table-column",{attrs:{prop:"expectStartTime",label:"预期最晚开始时间",width:"280"}}),a("el-table-column",{attrs:{prop:"expectReadyTime",label:"预期最晚就绪时间",width:"280"}}),a("el-table-column",{attrs:{width:"180",label:"就绪时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.showLine(t.$index,t)}}},[e._v("展示就绪时间")])]}}])})],1),a("el-drawer",{attrs:{title:"历史就绪时间",visible:e.drawer,size:"60%","with-header":!1},on:{"update:visible":function(t){e.drawer=t}}},[a("div",[a("echart",{ref:"chart-start",staticClass:"drawer-content",attrs:{options:e.startOptions,"auto-resize":!0}})],1),a("div",{staticStyle:{"margin-top":"50px"}},[a("echart",{ref:"chart-ready",staticClass:"drawer-content",attrs:{options:e.readyOptions,"auto-resize":!0}})],1)])],1)},G=[],q=(a("a15b"),{components:{VueSvgTree:j},data:function(){var e=this;return{activeIndex:"1",statusMap:{0:"未开始",1:"运行中",2:"执行出错",3:"执行成功",4:"暂停调度",13:"就绪，等待执行"},input:"",treeData:[],tableData:[],startOptions:{xAxis:{type:"time",axisLabel:{formatter:function(e){var t=new Date(e),a=[t.getMonth()+1,t.getDate()];return a.join("/")}},boundaryGap:["30%","10%"]},yAxis:{type:"time",axisLabel:{formatter:function(t){return e.secondToHour(t)}}},series:[{data:[],type:"line"}]},readyOptions:{xAxis:{type:"time",axisLabel:{formatter:function(e){var t=new Date(e),a=[t.getMonth()+1,t.getDate()];return a.join("/")}},boundaryGap:["30%","10%"]},yAxis:{type:"time",axisLabel:{formatter:function(t){return e.secondToHour(t)}}},series:[{data:[],type:"line"}]},drawer:!1}},mounted:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.initTaskReadyTime();case 2:null!=e.$route.query.taskName&&e.tableData.forEach((function(t){if(t.taskname==e.$route.query.taskName){console.log("route data",t);var a={row:t};e.showLine(0,a)}}));case 3:case"end":return t.stop()}}),t)})))()},methods:{initTaskReadyTime:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t.next=3,y().then((function(t){if(console.log(t),0===t.data.code){var n=t.data.data;null!=n&&void 0!=n&&(e.tableData=[],n.forEach((function(t){var a={};a["taskname"]=t["taskName"];var n=t["expectStartTime"],r=t["expectReadyTime"];a["expectStartTime"]=e.secondToHour(t["expectStartTime"]),a["expectReadyTime"]=e.secondToHour(t["expectReadyTime"]);var o=[],s=[],i=[],l=[];t["readyTimes"].forEach((function(e){o.push([e.dateTime,e.readyTime]),s.push([e.dateTime,e.startTime]),i.push([e.dateTime,r]),l.push([e.dateTime,n])})),a["readyTimeData"]=o,a["startTimeData"]=s,a["expectReadyTimes"]=i,a["expectStartTimes"]=l,e.tableData.push(a)})))}else e.$message.error("网络错误");a.close()})).catch((function(t){a.close(),e.$message.error("网络错误"),console.error(t)}));case 3:case"end":return t.stop()}}),t)})))()},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return t.index=a,t["hasWeakRelation"]?"warning-row":""},showLine:function(e,t){var a=this;console.log(t),this.startOptions={title:{text:"近30天任务开始时间",left:"center"},tooltip:{triggerOn:"mousemove",formatter:function(e){console.log(e);var t=new Date(1e3*e.data[0]),n=[t.getMonth()+1,t.getDate()],r=n.join("/"),o=a.secondToHour(e.data[1]);return r+"\n"+o}},legend:{bottom:0},xAxis:{type:"time",axisLabel:{formatter:function(e){var t=new Date(1e3*e),a=[t.getMonth()+1,t.getDate()];return a.join("/")}},boundaryGap:["30%","10%"]},yAxis:{type:"time",axisLabel:{formatter:function(e){return a.secondToHour(e)}}},series:[{name:"开始时间",data:t.row.startTimeData,type:"line"},{name:"预期最晚开始时间",data:t.row.expectStartTimes,type:"line",symbol:"none"}]},this.readyOptions={title:{text:"近30天任务就绪时间",left:"center"},tooltip:{triggerOn:"mousemove",axisPointer:{snap:!0},formatter:function(e){console.log(e);var t=new Date(1e3*e.data[0]),n=[t.getMonth()+1,t.getDate()],r=n.join("/"),o=a.secondToHour(e.data[1]);return r+"<br />"+o}},legend:{bottom:0},xAxis:{type:"time",axisLabel:{formatter:function(e){var t=new Date(1e3*e),a=[t.getMonth()+1,t.getDate()];return a.join("/")}},boundaryGap:["30%","10%"]},yAxis:{type:"time",axisLabel:{formatter:function(e){return a.secondToHour(e)}}},series:[{name:"就绪时间",data:t.row.readyTimeData,type:"line"},{name:"预期最晚就绪时间",data:t.row.expectReadyTimes,type:"line",symbol:"none"}]},console.log(this.orgOptions),this.drawer=!0},showEditRemark:function(e,t,a,n){console.log(e,t,a,n),e.showEdit||"remark"!=t.property||(e.showEdit=!0,this.$set(this.tableData,e.index,e),console.log("refs",this.$refs["remark".concat(e.index)]),this.$nextTick((function(){this.$refs["remark".concat(e.index)].$el.querySelector("input").focus()})),this.$set(this.tableData,e.index,e))},handleUpdate:function(e,t){var a=this;console.log(t),t.showEdit=!1,null!=t.taskname&&null!=t.remark&&N(t.taskname,t.remark).then((function(e){console.log(e),0===e.data.code?a.$message.success("更新成功"):a.$message.error("网络错误")})).catch((function(e){a.$message.error("网络错误"),console.error(e)})),this.$set(this.tableData,t.index,t)},time:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),r=e.getHours(),o=e.getMinutes(),s=e.getSeconds();return t+"-"+this.addZero(a)+"-"+this.addZero(n)+" "+this.addZero(r)+":"+this.addZero(o)+":"+this.addZero(s)},addTask:function(){var e=this;this.$prompt("请输入ETL任务名","",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(t){var a=t.value;if(null!=a){var n=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});_(a).then((function(t){console.log(t),0===t.data.code?(e.initTaskReadyTime(),e.$message.success("更新成功"),e.$set(e.tableData,0,e.tableData[0])):e.$message.error("网络错误"),n.close()})).catch((function(t){e.$message.error("网络错误"),console.error(t),n.close()}))}})).catch((function(t){console.error(t),e.$message({type:"info",message:"取消输入"})}))},addZero:function(e){return e<10?"0"+e:e},secondToHour:function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),n=e-3600*t-60*a,r=[this.addZero(t),this.addZero(a),this.addZero(n)];return r.join(":")}}}),P=q,B=(a("058b"),Object(l["a"])(P,W,G,!1,null,"ed1cd8c8",null)),U=B.exports,J=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text item"},[e._v("1.数据来源：Cantor API")]),a("div",{staticClass:"text item"},[e._v("2.关系图为力导图，节点位置自动定义，图可缩放和拖拽")]),a("div",{staticClass:"text item"},[e._v("3.可把多个叶子结点放在一个关系图中查看")])]),a("el-row",{attrs:{gutter:2}},[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{type:"info"}},[e._v("选择叶子结点：")])],1),a("el-col",{attrs:{span:10}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择叶子结点"},on:{change:e.change},model:{value:e.leafTasksValue,callback:function(t){e.leafTasksValue=t},expression:"leafTasksValue"}},e._l(e.leafTasks,(function(e){return a("el-option",{key:e.key,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-col",{attrs:{span:3,offset:6}},[a("el-dropdown",[a("el-button",[e._v(" 过滤的项目组 "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[e._v("hmart_waimaiuser")]),a("el-dropdown-item",[e._v("hmart_waimai_bizdata")]),a("el-dropdown-item",[e._v("hmart_waimaibizdata")]),a("el-dropdown-item",[e._v("hadoop-waimaibizdata")]),a("el-dropdown-item",[e._v("hadoop-hmart-waimaiuser")]),a("el-dropdown-item",[e._v("mart_waimaibizdatacollect_bizdatacollect")])],1)],1)],1),a("el-col",{attrs:{span:2}},[a("el-button",{on:{click:e.addTask}},[e._v("增加叶子ETL任务")])],1)],1),a("div",{staticClass:"container"},[a("echart",{ref:"chart",style:e.chartStyle,attrs:{options:e.graphOptions,initOptions:e.initOptions,"auto-resize":!0},on:{dblclick:e.handleClick,click:e.copy}})],1)],1)},Q=[],F=(a("d81d"),a("b0c0"),a("d3b7"),{components:{VueSvgTree:j},data:function(){return{initOptions:{renderer:"svg"},activeIndex:"1",statusMap:{0:"未开始",1:"运行中",2:"执行出错",3:"执行成功",4:"暂停调度",13:"就绪，等待执行"},input:"",treeData:[],tableData:[],leafTasks:[],leafTasksValue:[],graphOptions:{},drawer:!1,chartStyle:"width: 1538px;height: 1500px;margin-top: 20px",width:1538,height:1500}},mounted:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.initTask();case 2:if(!(e.leafTasks.length>1)){t.next=6;break}return e.leafTasksValue=[e.leafTasks[0].name,e.leafTasks[1].name],t.next=6,e.initTaskGraph(e.leafTasksValue);case 6:return console.log("graphArea",e.$graphArea),e.chartStyle="width: "+e.$graphArea.width+"px;height: "+e.$graphArea.height+"px;margin-top: 20px;",console.log("chartStyle",e.chartStyle),t.next=11,new Promise((function(e){return setTimeout(e,100)}));case 11:e.$refs.chart.refresh();case 12:case"end":return t.stop()}}),t)})))()},methods:{handleClick:function(e){console.log(e),void 0!=e.data.des&&window.open("http://xt.sankuai.com/workbench/task/"+e.data.des)},copy:function(e){console.log(e);var t=this;void 0!=e.data.des&&this.$copyText(e.data.des+"\n"+e.data.owner).then((function(e){t.$message.success("拷贝成功"),console.log(e)}),(function(e){t.$message.success("拷贝失败"),console.log(e)}))},compare:function(e,t){return e.level!==t.level?e.deep-t.deep:e.parent===t.parent?e.id-t.id:this.compare(e.parent,t.parent)},change:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("style",t.$refs),0!=t.leafTasksValue.length){e.next=5;break}t.graphOptions={},e.next=7;break;case 5:return e.next=7,t.initTaskGraph(t.leafTasksValue);case 7:return console.log("refs",t.$refs,t.$graphArea),t.chartStyle="width: "+t.$graphArea.width+"px;height: "+t.$graphArea.height+"px;margin-top: 20px;",console.log("chartStyle",t.chartStyle),e.next=12,new Promise((function(e){return setTimeout(e,100)}));case 12:t.$refs.chart.refresh();case 13:case"end":return e.stop()}}),e)})))()},initTask:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t.next=3,k().then((function(t){if(console.log(t),0===t.data.code){var n=t.data.data;null!=n&&void 0!=n&&(e.leafTasks=[],n.forEach((function(t){e.leafTasks.push({key:t.id,name:t.taskName,value:t.taskName})})),console.log(e.leafTasks))}else e.$message.error("网络错误");a.close()})).catch((function(t){a.close(),e.$message.error("网络错误"),console.error(t)}));case 3:case"end":return t.stop()}}),t)})))()},initTaskGraph:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),a.next=3,w(e).then((function(a){if(console.log(a),0===a.data.code){var r=a.data.data;if(null!=r&&void 0!=r){var o=[];r.nodes.forEach((function(t){var a={name:""+t.id,des:t.taskName,owner:t.owner,symbolSize:200,category:-1!=e.indexOf(t.taskName)?2:t.isRoot?3:t.inProject?0:1};o.push(a)}));var s=[];r.edges.forEach((function(e){var t={source:""+e.source,target:""+e.target,name:""};s.push(t)})),console.log(o,s);var i=t;t.graphOptions={title:{text:"依赖关系图"},tooltip:{show:!0,formatter:function(e){return void 0!=e.data.des?"ETL:"+e.data.des+"\n负责人:"+e.data.owner:""}},toolbox:{show:!0,feature:{myRefresh:{show:!0,title:"还原",icon:"path://M85.333333 468.949333l-2.218666-0.042666-1.92-0.128a42.709333 42.709333 0 0 1-3.370667-0.469334l-1.749333-0.341333a26.368 26.368 0 0 1-2.474667-0.64l-2.474667-0.768a42.88 42.88 0 0 1-16.896-11.050667l3.370667 3.2a55.168 55.168 0 0 1-3.242667-3.072l-0.426666-0.469333a44.373333 44.373333 0 0 1-7.509334-11.349333l-1.066666-2.517334-0.768-2.176-0.682667-2.432a28.288 28.288 0 0 1-0.554667-2.602666l-0.341333-2.133334A49.450667 49.450667 0 0 1 42.666667 426.282667l0.085333 3.029333a51.285333 51.285333 0 0 1-0.085333-2.56V170.282667a42.666667 42.666667 0 0 1 85.333333 0v157.354666l125.141333-117.589333a426.666667 426.666667 0 0 1 496.469334-77.525333l11.392 6.101333a426.709333 426.709333 0 0 1-181.888 799.402667 426.666667 426.666667 0 0 1-426.922667-284.202667 42.624 42.624 0 1 1 80.469333-28.330667 341.290667 341.290667 0 0 0 654.762667-37.717333 341.333333 341.333333 0 0 0-167.68-374.485333A341.717333 341.717333 0 0 0 312.533333 271.36L193.024 383.573333 341.333333 383.616a42.666667 42.666667 0 0 1 42.368 37.674667L384 426.282667a42.666667 42.666667 0 0 1-42.666667 42.666666H85.333333z",onclick:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(i.graphOptions),i.chartStyle="width: "+i.$graphArea.width+"px;height: "+i.$graphArea.height+"px;margin-top: 20px;",i.graphOptions.series[0].zoom=1,e.next=5,new Promise((function(e){return setTimeout(e,100)}));case 5:i.$refs.chart.refresh(),console.log(i.chartStyle);case 7:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},saveAsImage:{show:!0,pixelRatio:3},myZoomUp:{show:!0,title:"放大图像",icon:"path://M0,-1 V1 M-1,0 H1",onclick:function(){console.log(i.graphOptions),i.graphOptions.series[0].zoom=.1+i.graphOptions.series[0].zoom}},myZoomDown:{show:!0,title:"缩小图像",icon:"path://M877.4 528.2H148.7c-10.5 0-19.1-8.6-19.1-19.1s8.6-19.1 19.1-19.1h728.7c10.5 0 19.1 8.6 19.1 19.1s-8.5 19.1-19.1 19.1z",onclick:function(){console.log(i.graphOptions),i.graphOptions.series[0].zoom=i.graphOptions.series[0].zoom-.1}}},left:1200},legend:[{left:500,data:[{name:"组内ETL"},{name:"组外ETL"},{name:"所选叶子节点"},{name:"末端节点"}].map((function(e){return e.name}))}],series:[{type:"graph",layout:"dagre",roam:"move",edgeSymbol:["arrow","circle"],edgeSymbolSize:[30,2],symbol:"roundRect",force:{repulsion:7500,edgeLength:[50,500]},zoom:1,draggable:!0,itemStyle:{},lineStyle:{normal:{width:2,color:"#4b565b"}},label:{show:!0,formatter:function(e){return e.data.des.substring(0,23)+"\n"+e.data.des.substring(23,46)+"\n"+e.data.des.substring(46)}},data:o,links:s,categories:[{name:"组内ETL"},{name:"组外ETL"},{name:"所选叶子节点"},{name:"末端节点"}]}]}}}else t.$message.error("网络错误");n.close()})).catch((function(e){n.close(),t.$message.error("网络错误"),console.error(e)}));case 3:case"end":return a.stop()}}),a)})))()},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return t.index=a,t["hasWeakRelation"]?"warning-row":""},showEditRemark:function(e,t,a,n){console.log(e,t,a,n),e.showEdit||"remark"!=t.property||(e.showEdit=!0,this.$set(this.tableData,e.index,e),console.log("refs",this.$refs["remark".concat(e.index)]),this.$nextTick((function(){this.$refs["remark".concat(e.index)].$el.querySelector("input").focus()})),this.$set(this.tableData,e.index,e))},handleUpdate:function(e,t){var a=this;console.log(t),t.showEdit=!1,null!=t.taskname&&null!=t.remark&&N(t.taskname,t.remark).then((function(e){console.log(e),0===e.data.code?a.$message.success("更新成功"):a.$message.error("网络错误")})).catch((function(e){a.$message.error("网络错误"),console.error(e)})),this.$set(this.tableData,t.index,t)},time:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),r=e.getHours(),o=e.getMinutes(),s=e.getSeconds();return t+"-"+this.addZero(a)+"-"+this.addZero(n)+" "+this.addZero(r)+":"+this.addZero(o)+":"+this.addZero(s)},addTask:function(){var e=this;this.$prompt("请输入ETL任务名","",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(t){var a=t.value;if(null!=a){var n=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});$(a).then((function(t){console.log(t),0===t.data.code?(e.initTask(),e.$message.success("更新成功")):e.$message.error("网络错误"),n.close()})).catch((function(t){e.$message.error("网络错误"),console.error(t),n.close()}))}})).catch((function(t){console.error(t),e.$message({type:"info",message:"取消输入"})}))},addZero:function(e){return e<10?"0"+e:e},secondToHour:function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),n=e-3600*t-60*a,r=[this.addZero(t),this.addZero(a),this.addZero(n)];return r.join(":")},getChartStyle:function(){return console.log("style",this.$refs),console.log(this.$refs.chart.height,this.$refs.chart.width),"width: "+this.$refs.chart.width+";height: "+this.$refs.chart.height+"px;margin-top: 20px;"}}}),Y=F,X=(a("447e"),Object(l["a"])(Y,J,Q,!1,null,"5d113b91",null)),K=X.exports,ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("el-container",[a("el-header"),a("el-main",[a("el-input",{attrs:{placeholder:"目标价格"},on:{input:e.refresh},model:{value:e.target,callback:function(t){e.target=t},expression:"target"}},[a("template",{slot:"prepend"},[e._v("目标价格：")])],2),a("el-input",{attrs:{placeholder:"送券价格"},model:{value:e.bonus,callback:function(t){e.bonus=t},expression:"bonus"}},[a("template",{slot:"prepend"},[e._v("送券价格：")])],2),a("el-input",{attrs:{placeholder:"满减门槛"},model:{value:e.discountLimit,callback:function(t){e.discountLimit=t},expression:"discountLimit"}},[a("template",{slot:"prepend"},[e._v("满减门槛：")])],2),a("el-input",{attrs:{placeholder:"满减额度"},model:{value:e.discount,callback:function(t){e.discount=t},expression:"discount"}},[a("template",{slot:"prepend"},[e._v("满减额度：")])],2),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text item",staticStyle:{"text-align":"left"}},[e._v("最优惠价格"+e._s(e.cost)+"元，使用满减券"+e._s(e.num)+"张。")])]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","row-class-name":e.tableRowClassName}},[a("el-table-column",{attrs:{prop:"first_cost",label:"第一次花费",width:"200"}}),a("el-table-column",{attrs:{prop:"num",label:"拿到满减券张数",width:"200"}}),a("el-table-column",{attrs:{prop:"second_cost",label:"第二次花费",width:"200"}}),a("el-table-column",{attrs:{prop:"use",label:"使用满减券张数",width:"200"}}),a("el-table-column",{attrs:{prop:"cost",label:"共花费",width:"200"}})],1)],1)],1)],1)},te=[],ae=(a("a9e3"),{name:"Main",components:{TaskRelationsData:V,TaskAlarmData:U,TaskGraph:K},data:function(){return{tableData:[],target:2e4,bonus:999,discountLimit:300,discount:80,cost:0,num:0}},mounted:function(){this.refresh()},methods:{tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return t.index=a,t["min"]?"warning-row":""},refresh:function(){this.tableData=[];for(var e=this.discountLimit-this.discount,t=Number.MAX_VALUE,a=0,n=0;n*this.bonus<=this.target;n++){var r=this.target-this.bonus*n,o=Math.floor(r/this.discountLimit);o>n&&(o=n),r-=o*this.discountLimit;var s=this.bonus*n+e*o+r;s<t&&(t=s,a=n),this.tableData.push({first_cost:n+"*"+this.bonus+"="+n*this.bonus,num:n,second_cost:this.target-this.bonus*n+"-"+this.discount+"*"+o+"="+(e*o+r),use:o,cost:s,min:!1})}this.cost=this.tableData[a].cost,this.num=this.tableData[a].use,this.tableData[a].min=!0,console.log(this.tableData)}}}),ne=ae,re=(a("c266"),Object(l["a"])(ne,ee,te,!1,null,null,null)),oe=re.exports;n["default"].use(p["a"]);var se,ie,le=new p["a"]({routes:[{path:"/",component:oe}]}),ce=le,de="",ue={BASE_URL:de},he=ue,pe=Object(l["a"])(he,se,ie,!1,null,null,null),me=pe.exports,fe=a("5c96"),ge=a.n(fe);a("0fae");n["default"].use(ge.a);var ve=a("4eb5"),we=a.n(ve),ke=a("9ca8");a("ef97"),a("23ee"),a("007d"),a("d28f"),a("627c"),a("b11c");n["default"].component("echart",ke["a"]),n["default"].use(we.a),n["default"].prototype.GLOBAL=me,n["default"].prototype.$graphArea={width:1538,height:1500},h.a.defaults.withCredentials=!0,n["default"].config.productionTip=!1;var be=a("313e"),xe=a("e34f"),ye={rankdir:"BT"};be.registerLayout((function(e,t){e.eachSeriesByType("graph",(function(e){var t=e.get("layout"),a=e.getGraph(),r=new xe.graphlib.Graph,o=e.coordinateSystem;if(!o||"view"!==o.type)throw new Error("Dagre layout not support coordinate system.");var s=be.util.extend({},ye);if(be.util.extend(s,e.get("dagreLayout")),r.setGraph({}),r.setDefaultEdgeLabel((function(){return{}})),"dagre"===t){a.eachNode((function(e){var t=e.getModel(),a=t.get("symbolSize");a instanceof Array||(a=[a,a]),r.setNode(e.id,{width:10,height:10})})),a.eachEdge((function(e){r.setEdge(e.node1.id,e.node2.id)})),r.graph().rankdir="BT",xe.layout(r),console.log(r.graph());var i=1/0,l=1/0,c=-1/0,d=-1/0,u=e.getData(),h=e.getEdgeData();r.nodes().forEach((function(e,t){e=r.node(e),u.setItemLayout(t,[e.x,e.y]),i=Math.min(i,e.x),l=Math.min(l,e.y),c=Math.max(c,e.x),d=Math.max(d,e.y)})),r.edges().forEach((function(e,t){var a=r.node(e.v),n=r.node(e.w),o=h.getItemModel(t),i=o.get("lineStyle.normal.curveness"),l=[[a.x,a.y],[n.x,n.y]];if(i>0){var c=(a.x+n.x)/2*(1-i),d=(a.y+n.y)/2*(1-i);"LR"===s.rankdir||"RL"===s.rankdir?l.push([a.x*i+c,n.y*i+d]):l.push([n.x*i+c,a.y*i+d])}h.setItemLayout(t,l)}));var p=(c-i)/(d-l),m=o.getViewRect(),f=m.width/m.height;if(console.log(i,l,c,d,p,m),p>f){var g=m.width/p;m.y+=(m.height-g)/2,m.y=m.y<0?0:m.y,m.height=g}else{var v=m.height*p;m.x+=(m.width-v)/2,m.x=m.x<0?0:m.x,m.width=v}o.setBoundingRect(i,l,c-i,d-l);var w=6*r.graph().width;w=w<1e3?1e3:w;var k=w/p;m.y+=(m.height-k)/2,m.y=m.y<0?0:m.y,m.x+=(m.width-w)/2,m.x=m.x<0?0:m.x,o.setViewRect(m.x,m.y,w,k),m=o.getViewRect(),n["default"].prototype.$graphArea={width:w/6*8,height:k/6*8},console.log(i,l,c,d,p,m)}}))})),new n["default"]({router:ce,render:function(e){return e(d)}}).$mount("#app")},"769f":function(e,t,a){"use strict";var n=a("41f0"),r=a.n(n);r.a},8084:function(e,t,a){},"85ec":function(e,t,a){},c266:function(e,t,a){"use strict";var n=a("3a7d"),r=a.n(n);r.a}});
//# sourceMappingURL=app.cc58f848.js.map